### `.github/copilot-instruction.md`

## このドキュメントについて

- GitHub Copilot や各種 AI ツールが本リポジトリのコンテキストを理解しやすくするためのガイドです。
- 新しい機能を実装する際はここで示す技術選定・設計方針・モジュール構成を前提にしてください。
- 不確かな点がある場合は、リポジトリのファイルを探索し、ユーザーに「こういうことですか?」と確認をするようにしてください。

## 前提条件

- 回答は必ず日本語でしてください。
- コードの変更をする際、変更量が200行を超える可能性が高い場合は、事前に「この指示では変更量が200行を超える可能性がありますが、実行しますか?」とユーザーに確認をとるようにしてください。
- 何か大きい変更を加える場合、まず何をするのか計画を立てた上で、ユーザーに「このような計画で進めようと思います。」と提案してください。この時、ユーザーから計画の修正を求められた場合は計画を修正して、再提案をしてください。

## アプリ概要

**English Tadoku App** は、ユーザーが英語の多読（Extensive Reading）を習慣化し、その進捗を可視化することで英語力向上をサポートするWebアプリケーションです。

### 主な機能

- **ユーザー認証**: サインアップ、ログイン、ログアウト機能 (JWTベース)
- **AIによるストーリー生成**: ユーザーが入力したプロンプトを元に、Google Geminiが簡単な英語の物語を生成
- **CRUD機能**: 生成されたストーリーの一覧表示(Read)、詳細表示(Read)、タイトル編集(Update)、削除(Delete)
- **読書記録**: ストーリーを「読み終えた」ことを記録し、読了回数や累計単語数をトラッキング
- **統計ダッシュボード**: 日、週、月、年単位での読了単語数を表示
- **進捗の可視化**: 過去7日間の読書量を棒グラフで表示
- **レスポンシブデザイン**: デスクトップからモバイルまで対応

## 技術スタック概要

### バックエンド (`backend/`)
- **言語**: Go (Golang) 1.22+
- **Webフレームワーク**: Echo v4
- **データベース**: PostgreSQL 15
- **DBドライバ/ライブラリ**: `pq`, `sqlx`
- **マイグレーション**: `migrate/migrate`
- **認証**: JWT (`golang-jwt/v5`)
- **バリデーション**: `go-playground/validator`
- **AIサービス**: Google Gemini API (`google.golang.org/genai`)
- **テスト**: Go標準 `testing`, `stretchr/testify` (アサーション, モック)
- **コンテナ**: Docker, Docker Compose

### フロントエンド (`frontend/`)
- **言語**: TypeScript 5.x
- **フレームワーク**: React 18.x
- **ビルドツール**: Vite 5.x
- **パッケージマネージャー**: npm
- **状態管理**: React Hooks (`useState`, `useEffect`, `useContext`)
- **ルーティング**: React Router v6
- **スタイリング**: Tailwind CSS (v4)
- **UIコンポーネント**: Headless UI (モーダル), Heroicons/Lucide (アイコン)
- **API通信**: Axios
- **Markdown**: `react-markdown`
- **リンター/フォーマッター**: ESLint, Prettier

## プロジェクト構成と役割

### バックエンド (`backend/`)

Goの標準的なレイヤードアーキテクチャを採用しています。

```
backend/
├── cmd/api/         # アプリケーションのエントリーポイント (main.go)
├── db/migrations/   # データベースのスキーマ定義
├── internal/
│   ├── handler/     # HTTPリクエスト/レスポンス層 (コントローラー)
│   ├── middleware/  # JWT認証などのミドルウェア
│   ├── model/       # DBテーブルに対応する構造体 (エンティティ)
│   ├── repository/  # DBとの直接的なやり取り (SQL実行)
│   └── service/     # 外部API連携 (Gemini)
├── Dockerfile       # 本番用Dockerイメージのビルド定義
├── go.mod           # 依存関係定義
└── go.sum           # 依存関係のチェックサム
```

- **設計思想**: 依存性の注入(DI)を基本とし、`main.go`でリポジトリ等を生成し、ハンドラに渡します。ハンドラとリポジトリはインターフェースによって定義され、疎結合を保ちます。

### フロントエンド (`frontend/`)

機能と役割に基づいた、標準的なReactのコンポーネントベースアーキテクチャを採用しています。

```
frontend/
└── src/
    ├── components/    # 再利用可能なUIコンポーネント (AuthPage, Dashboard, StoryDetail等)
    ├── contexts/      # グローバルな状態管理 (AuthContext.tsx)
    ├── types/         # アプリ全体で共有するTypeScriptの型定義 (index.ts)
    ├── apiClient.ts   # 中央集権的なAxiosインスタンスとインターセプター
    ├── App.tsx        # ルーティング定義を含むルートコンポーネント
    └── main.tsx       # アプリケーションのエントリーポイント、グローバルプロバイダーの設定
```

- **設計思想**:
    - **Stateの引き上げ (Lifting State Up)**: 複数の子コンポーネントで共有が必要な状態は、最も近い共通の親コンポーネントで管理します。
    - **関心の分離**: データ取得や状態管理のロジックを持つコンポーネント（スマートコンポーネント）と、`props`を受け取って表示に専念するコンポーネント（ダムコンポーネント）を意識的に分離します。
    - **型安全**: バックエンドのJSONレスポンスに合わせて、`src/types/index.ts`で型を厳密に定義します。JSONのキーは`snake_case`に統一します。

## コーディング規約と主要パターン

### バックエンド (Go)

- **エラーハンドリング**: `fmt.Errorf("...: %w", err)` を使用してエラーをラップし、スタックトレースを追えるようにします。
- **命名規則**: Goの標準的な命名規則に従います。インターフェースは`IStoryRepository`のように`I`プレフィックスを付けています。
- **テスト**: `repository`層はDBに接続するインテグレーションテスト、`handler`層は`testify/mock`を使ったユニットテストを基本とします。

### フロントエンド (React)

- **スタイリング**: **Tailwind CSSのユーティリティクラスを最優先**します。`style`属性の直接指定は、動的な値を扱う場合（例: `height: \`\${percent}%\``）に限定します。
- **API通信**: 必ず共有の`apiClient`インスタンスを使用します。`fetch`や新しい`axios`インスタンスをコンポーネント内で生成するのは避けてください。
- **状態管理**: サーバーから取得したデータは`useEffect`と`useState`で管理します。認証情報のようなアプリ全体の状態は`AuthContext`で管理します。
- **コンポーネントの責務**: コンポーネントは単一責任の原則を意識し、一つのことだけをうまくやるように設計します。例えば、`StoryList.tsx`は`stories`配列を受け取って表示することに専念します。